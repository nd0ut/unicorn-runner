import { splash } from "../Splash";
import { Striker } from "../Traits";
import { defineLevel } from "./defineLevel";
import { clamp } from "../math";

const spec = {
  name: "shooting",
  spawn: [96, 64],
  background: {
    images: {
      sky: require("../../img/backgrounds/clouds.png"),
      back: require("../../img/backgrounds/mountains.png"),
      front: require("../../img/backgrounds/forest.png")
    },
    gradient: camPos => {
      return [
        ["#256bcc", 0],
        ["#2278c6", clamp(0.4 - camPos.y * 0.0001, 0, 0.8)],
        ["#00c7a4", 0.8]
      ];
    }
  },
  sounds: [
    {
      url: require("../../sounds/hooked-on-a-feeling.mp3"),
      name: "music"
    }
  ],
  tileSprite: {
    imageURL: require("../../img/tiles/y5lxj.png"),
    tileW: 60,
    tileH: 60,
    frames: [
      {
        name: "grass",
        rect: [60 * 0, 0, 60, 60]
      },
      {
        name: "stone",
        rect: [60 * 1, 0, 60, 60]
      },
      {
        name: "dirt",
        rect: [60 * 2, 0, 60, 60]
      },
      {
        name: "default",
        rect: [60 * 3, 0, 60, 60]
      },

      {
        name: "stone2",
        rect: [60 * 0, 60, 60, 60]
      },
      {
        name: "wood",
        rect: [60 * 1, 60, 60, 60]
      },
      {
        name: "sand",
        rect: [60 * 2, 60, 60, 60]
      }
    ]
  },
  tiles: [
    ["default", 1, 7],
    ["default", 2, 7],
    ["default", 3, 7],
    ["default", 4, 7],
    ["default", 5, 7],
    ["default", 6, 7],
    ["default", 7, 7],
    ["default", 8, 7],
    ["default", 9, 7],
    ["default", 10, 7],
    ["default", 11, 7],
    ["default", 12, 7],
    ["default", 13, 7],
    ["default", 14, 7],
    ["default", 15, 7],
    ["default", 16, 7],
    ["wood", 17, 6],
    ["default", 17, 7],
    ["wood", 18, 5],
    ["wood", 18, 6],
    ["default", 18, 7],
    ["wood", 24, 5],
    ["wood", 24, 6],
    ["wood", 24, 7],
    ["default", 24, 8],
    ["wood", 25, 6],
    ["wood", 25, 7],
    ["default", 25, 8],
    ["wood", 26, 7],
    ["default", 26, 8],
    ["default", 27, 8],
    ["default", 28, 8],
    ["default", 29, 8],
    ["default", 30, 8],
    ["default", 31, 8],
    ["default", 32, 8],
    ["default", 33, 8],
    ["default", 34, 8],
    ["default", 35, 8],
    ["default", 36, 8],
    ["default", 37, 8],
    ["default", 38, 8],
    ["default", 39, 8],
    ["wood", 46, 7],
    ["wood", 47, 7],
    ["wood", 48, 7],
    ["wood", 49, 7],
    ["wood", 50, 7],
    ["wood", 51, 7],
    ["wood", 52, 7],
    ["wood", 53, 6],
    ["wood", 53, 7],
    ["wood", 54, 6],
    ["wood", 55, 6],
    ["wood", 56, 6],
    ["wood", 57, 6],
    ["wood", 58, 6],
    ["wood", 59, 6],
    ["wood", 60, 5],
    ["wood", 60, 6],
    ["wood", 61, 5],
    ["wood", 62, 5],
    ["wood", 63, 5],
    ["wood", 64, 5],
    ["wood", 65, 5],
    ["wood", 66, 4],
    ["wood", 66, 5],
    ["wood", 67, 4],
    ["wood", 68, 4],
    ["wood", 69, 4],
    ["wood", 70, 4],
    ["wood", 71, 4],
    ["wood", 72, 4],
    ["wood", 73, 4],
    ["wood", 74, 4],
    ["wood", 75, 4],
    ["wood", 76, 4],
    ["wood", 77, 4],
    ["wood", 78, 4],
    ["wood", 79, 4],
    ["wood", 80, -10],
    ["wood", 80, -9],
    ["wood", 80, -8],
    ["wood", 80, -7],
    ["wood", 80, -6],
    ["wood", 80, -5],
    ["wood", 80, -4],
    ["wood", 80, -3],
    ["wood", 80, 4],
    ["wood", 81, 4],
    ["wood", 82, -10],
    ["wood", 82, -9],
    ["wood", 82, -8],
    ["wood", 82, -7],
    ["wood", 82, -6],
    ["wood", 82, -5],
    ["wood", 82, -4],
    ["wood", 82, -3],
    ["wood", 82, 4],
    ["default", 83, -4],
    ["wood", 83, -3],
    ["wood", 83, 4],
    ["default", 84, -3],
    ["wood", 84, -2],
    ["wood", 84, 4],
    ["wood", 84, 5],
    ["wood", 84, 6],
    ["wood", 84, 7],
    ["wood", 84, 8],
    ["wood", 84, 9],
    ["default", 85, -3],
    ["wood", 85, -2],
    ["default", 85, 5],
    ["dirt", 85, 6],
    ["dirt", 85, 7],
    ["stone", 85, 8],
    ["stone", 85, 9],
    ["default", 86, -3],
    ["wood", 86, -2],
    ["default", 86, 6],
    ["dirt", 86, 7],
    ["stone", 86, 8],
    ["stone", 86, 9],
    ["default", 87, -2],
    ["wood", 87, -1],
    ["default", 87, 6],
    ["dirt", 87, 7],
    ["stone", 87, 8],
    ["stone", 87, 9],
    ["default", 88, -1],
    ["wood", 88, 0],
    ["default", 88, 6],
    ["dirt", 88, 7],
    ["stone", 88, 8],
    ["stone", 88, 9],
    ["default", 89, 0],
    ["wood", 89, 1],
    ["default", 89, 6],
    ["dirt", 89, 7],
    ["stone", 89, 8],
    ["stone", 89, 9],
    ["default", 90, 1],
    ["wood", 90, 2],
    ["default", 90, 6],
    ["dirt", 90, 7],
    ["stone", 90, 8],
    ["stone", 90, 9],
    ["default", 91, 1],
    ["wood", 91, 2],
    ["default", 91, 6],
    ["dirt", 91, 7],
    ["stone", 91, 8],
    ["stone", 91, 9],
    ["default", 92, 6],
    ["dirt", 92, 7],
    ["stone", 92, 8],
    ["stone", 92, 9],
    ["default", 93, 6],
    ["dirt", 93, 7],
    ["stone", 93, 8],
    ["stone", 93, 9],
    ["dirt", 94, 7],
    ["stone2", 94, 8],
    ["stone", 94, 9],
    ["stone2", 95, 8],
    ["stone2", 95, 9],
    ["stone2", 96, 9],
    ["stone2", 97, 9],
    ["stone2", 98, 9],
    ["stone2", 99, 9],
    ["stone2", 100, 9],
    ["stone2", 101, 9],
    ["wood", 102, 4],
    ["stone2", 102, 9],
    ["wood", 103, 4],
    ["wood", 103, 5],
    ["stone2", 103, 9],
    ["stone2", 104, 9],
    ["stone2", 105, 9],
    ["stone2", 106, 9],
    ["stone2", 107, 9],
    ["stone2", 108, 9],
    ["stone2", 109, 9],
    ["stone2", 110, 9],
    ["default", 118, 5],
    ["default", 119, 5],
    ["default", 120, 5],
    ["default", 121, 5],
    ["dirt", 121, 6],
    ["default", 122, 6],
    ["dirt", 122, 7],
    ["default", 123, 7],
    ["dirt", 123, 8],
    ["default", 124, 8],
    ["default", 125, 8],
    ["default", 126, 8],
    ["default", 127, 8],
    ["default", 128, 8],
    ["default", 129, 8],
    ["default", 130, 8],
    ["default", 131, 8],
    ["default", 132, 8],
    ["default", 133, 8],
    ["wood", 134, 2],
    ["default", 134, 8],
    ["default", 135, 8],
    ["default", 136, 8],
    ["default", 137, 8],
    ["default", 138, 8],
    ["default", 139, 8],
    ["default", 140, 8],
    ["default", 141, 8],
    ["default", 142, 8],
    ["default", 143, 8],
    ["default", 144, 8],
    ["default", 145, 8],
    ["stone2", 146, 5],
    ["stone2", 146, 8],
    ["dirt", 146, 9],
    ["stone2", 147, 4],
    ["stone2", 147, 5],
    ["stone2", 147, 8],
    ["dirt", 147, 9],
    ["stone2", 148, 4],
    ["stone2", 148, 8],
    ["dirt", 148, 9],
    ["wood", 149, 3],
    ["stone2", 149, 4],
    ["stone2", 149, 8],
    ["dirt", 149, 9],
    ["wood", 150, 3],
    ["stone2", 150, 4],
    ["stone2", 150, 8],
    ["dirt", 150, 9],
    ["stone2", 151, 4],
    ["stone2", 151, 8],
    ["dirt", 151, 9],
    ["wood", 152, 3],
    ["stone2", 152, 4],
    ["stone2", 152, 8],
    ["dirt", 152, 9],
    ["stone2", 153, 4],
    ["stone2", 153, 8],
    ["dirt", 153, 9],
    ["stone2", 154, 3],
    ["stone2", 154, 4],
    ["stone2", 154, 8],
    ["dirt", 154, 9],
    ["wood", 155, 2],
    ["stone2", 155, 3],
    ["stone2", 155, 4],
    ["stone2", 155, 8],
    ["dirt", 155, 9],
    ["stone2", 156, 3],
    ["stone2", 156, 4],
    ["stone2", 156, 8],
    ["dirt", 156, 9],
    ["stone2", 157, 4],
    ["stone2", 157, 8],
    ["dirt", 157, 9],
    ["stone2", 158, 4],
    ["stone2", 158, 8],
    ["dirt", 158, 9],
    ["wood", 159, 3],
    ["stone2", 159, 4],
    ["stone2", 159, 8],
    ["dirt", 159, 9],
    ["stone2", 160, 4],
    ["stone2", 160, 5],
    ["stone2", 160, 8],
    ["dirt", 160, 9],
    ["stone2", 161, 5],
    ["stone2", 161, 8],
    ["dirt", 161, 9],
    ["grass", 162, 8],
    ["dirt", 162, 9],
    ["stone2", 163, 8],
    ["dirt", 163, 9],
    ["grass", 164, 8],
    ["dirt", 164, 9],
    ["stone2", 165, 8],
    ["dirt", 165, 9],
    ["wood", 166, 7],
    ["grass", 166, 8],
    ["dirt", 166, 9],
    ["stone2", 167, 8],
    ["dirt", 167, 9],
    ["grass", 168, 8],
    ["dirt", 168, 9],
    ["stone2", 169, 8],
    ["dirt", 169, 9],
    ["grass", 170, 8],
    ["dirt", 170, 9],
    ["stone2", 171, 8],
    ["dirt", 171, 9],
    ["wood", 172, 7],
    ["stone2", 172, 8],
    ["dirt", 172, 9],
    ["wood", 173, 6],
    ["wood", 173, 7],
    ["grass", 173, 8],
    ["dirt", 173, 9],
    ["wood", 174, 7],
    ["grass", 174, 8],
    ["dirt", 174, 9],
    ["stone2", 175, 8],
    ["dirt", 175, 9],
    ["grass", 176, 8],
    ["dirt", 176, 9],
    ["stone2", 177, 8],
    ["dirt", 177, 9],
    ["grass", 178, 8],
    ["dirt", 178, 9],
    ["stone2", 179, 8],
    ["dirt", 179, 9],
    ["grass", 180, 8],
    ["dirt", 180, 9],
    ["wood", 181, 7],
    ["default", 181, 8],
    ["dirt", 181, 9],
    ["wood", 182, 7],
    ["default", 182, 8],
    ["dirt", 182, 9],
    ["default", 183, 8],
    ["dirt", 183, 9],
    ["default", 184, 8],
    ["dirt", 184, 9],
    ["default", 185, 8],
    ["dirt", 185, 9],
    ["default", 186, 8],
    ["dirt", 186, 9],
    ["default", 187, 8],
    ["dirt", 187, 9],
    ["default", 188, 8],
    ["dirt", 188, 9],
    ["default", 189, 8],
    ["dirt", 189, 9],
    ["default", 190, 8],
    ["dirt", 190, 9],
    ["default", 191, 8],
    ["dirt", 191, 9],
    ["default", 192, 8],
    ["dirt", 192, 9],
    ["default", 193, 8],
    ["dirt", 193, 9]
  ],
  entities: [
    { name: "manaPot", pos: [1266.0000186093064, 15] },
    { name: "enemy", pos: [2319.1666666666615, 381.5], skinName: "target" },
    { name: "manaPot", pos: [2792.1666666666615, 342], skinName: "default" },
    { name: "manaPot", pos: [2867, 344] },
    { name: "manaPot", pos: [2942, 345] },
    { name: "manaPot", pos: [3017.408459114388, 346] },
    { name: "manaPot", pos: [3090.408459114388, 348] },
    { name: "manaPot", pos: [3210.1666666666615, 284], skinName: "default" },
    { name: "manaPot", pos: [3283.9999999999914, 285] },
    { name: "manaPot", pos: [3357.9999999999914, 285] },
    { name: "manaPot", pos: [3430.9999999999914, 287] },
    { name: "manaPot", pos: [3502.9999999999914, 287] },
    { name: "manaPot", pos: [3592.1666666666615, 227], skinName: "default" },
    { name: "manaPot", pos: [3664.050762163021, 227] },
    { name: "manaPot", pos: [3733.050762163021, 228] },
    { name: "manaPot", pos: [3805.050762163021, 228] },
    { name: "manaPot", pos: [3876.050762163021, 228] },
    { name: "speedBooster", pos: [4028.498282284062, 177.5] },
    { name: "speedBooster", pos: [4781.498282284062, 62.5] },
    { name: "enemy", skinName: "cactus", pos: [4858.074896158258, 165.5] },
    { name: "enemy", skinName: "cactus", pos: [4859, -14.5] },
    { name: "enemy", skinName: "cactus", pos: [4859, -398.5] },
    { name: "enemy", skinName: "cactus", pos: [4859, 45.91666666666667] },
    { name: "enemy", skinName: "cactus", pos: [4859, 108.5] },
    { name: "enemy", skinName: "cactus", pos: [4859.074896158258, -210] },
    { name: "enemy", skinName: "cactus", pos: [4860, -74.5] },
    { name: "enemy", skinName: "cactus", pos: [4860, -463.08333333333337] },
    { name: "enemy", skinName: "cactus", pos: [4860.074896158258, -143.5] },
    { name: "enemy", skinName: "cactus", pos: [4860.074896158258, -275] },
    { name: "enemy", skinName: "cactus", pos: [4860.074896158258, -335] },
    { name: "enemy", pos: [4860.597505721113, -579.5], skinName: "cactus" },
    { name: "enemy", skinName: "cactus", pos: [4861, -641.75] },
    { name: "enemy", skinName: "cactus", pos: [4861, -519.5] },
    { name: "rainbow", pos: [4952.685545762244, 35.5] },
    { name: "enemy", skinName: "cactus", pos: [5618.503676392036, 289] },
    { name: "enemy", skinName: "cactus", pos: [5640.333333333396, 341] },
    { name: "enemy", skinName: "cactus", pos: [5700.333333333396, 402] },
    { name: "enemy", skinName: "cactus", pos: [5760.333333333396, 461] },
    { name: "enemy", skinName: "cactus", pos: [5815.333333333396, 467] },
    { name: "enemy", skinName: "cactus", pos: [5875.333333333396, 468] },
    { name: "enemy", skinName: "cactus", pos: [5939.958719207056, 467] },
    { name: "enemy", pos: [6104, 167], skinName: "cactus" },
    { name: "rainbow", pos: [6826.5, 229.5], skinName: "default" },
    { name: "manaPot", pos: [7065.899479945025, 228], skinName: "default" },
    { name: "manaPot", pos: [7119.1666666666615, 229], skinName: "default" },
    { name: "manaPot", pos: [7180.193362357293, 228], skinName: "default" },
    { name: "manaPot", pos: [7236, 227], skinName: "default" },
    {
      name: "enemy",
      pos: [8018.1666666666615, 25],
      skinName: "target",
      id: "target-1"
    },
    {
      name: "enemy",
      pos: [8324.672259524485, 385],
      skinName: "target",
      id: "target-2"
    },
    {
      name: "enemy",
      pos: [8726.672259524486, 206],
      skinName: "target",
      id: "target-3"
    },
    {
      name: "door",
      pos: [8760.666972841413, 315.5],
      skinName: "default",
      id: "door-1"
    },
    {
      name: "speedBooster",
      pos: [8801.896812757153, 399.5],
      skinName: "default"
    },
    { name: "enemy", pos: [9664, 406.5], skinName: "cactus" }
  ]
};

export default defineLevel(spec, createLevelOptions());

function createLevelOptions() {
  const howToSplash = howToSplasher();

  return {
    onStart: (game, level) => {
      // level.sounds.get('music').playOnce();
    },
    afterUpdate: (game, level) => {
      howToSplash(game, level);
      checkDoor1(game, level);
    }
  }
}

function howToSplasher() {
  let firstJumpReached = false;

  return (game, level) => {
      const player = game.playerEnv.playerController.player;
      const firstJumpX = 1200;

      const nearFirstJump = Math.abs(player.pos.x - firstJumpX) < 10;
      if (!firstJumpReached && nearFirstJump) {
          firstJumpReached = true;
          splash('press f to fire', { size: 50, timeout: 2000 });
      }
  };
}

function checkDoor1(game, level) {
  const targetIds = ["target-1", "target-2", "target-3"];
  const doorId = "door-1";

  const door = level.namedEntities.get(doorId);

  if (door.behavior.opened) {
    return;
  }

  const allTargetsDead = targetIds.every(id => {
    const entity = level.namedEntities.get(id);
    const dead = entity.killable.dead;
    return dead;
  });

  if (allTargetsDead) {
    door.behavior.open();
  }
}
